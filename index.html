<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Esmaran AI | Pro Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@900&family=Montserrat:wght@900&family=Oswald:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #fff; font-family: 'Inter', sans-serif; margin: 0; padding: 10px; overflow-x: hidden; }
        
        /* Telefon Ön İzleme Bölümü */
        .preview-container { position: sticky; top: 0; z-index: 50; background: #000; padding: 10px 0; }
        .phone-mockup { width: 140px; aspect-ratio: 9/16; background: #111; border-radius: 20px; border: 2px solid #222; margin: 0 auto; position: relative; overflow: hidden; }
        
        #sub-preview { 
            position: absolute; cursor: move; display: flex; align-items: center; justify-content: center;
            text-align: center; font-weight: 900; line-height: 1.1; 
            background: rgba(0,0,0,0.8); color: #fff; padding: 5px;
            top: 40%; left: 5%; width: 90%; font-size: 14px;
            touch-action: none; text-transform: uppercase;
        }

        /* Ayar Paneli */
        .control-panel { background: #080808; border-radius: 25px; padding: 20px; border: 1px solid #111; margin-top: 10px; }
        .input-dark { background: #111; border: 1px solid #222; padding: 12px; border-radius: 12px; width: 100%; color: #fff; font-size: 14px; margin-bottom: 15px; outline: none; }
        
        .slider-group { margin-bottom: 20px; }
        .slider-group label { display: flex; justify-content: space-between; font-size: 10px; font-weight: 800; color: #555; margin-bottom: 8px; }
        
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 4px; background: #222; border-radius: 10px; accent-color: #f59e0b; }
        
        .color-area { display: flex; justify-content: center; margin-bottom: 20px; }
        .big-action-btn { width: 100%; background: #fff; color: #000; font-weight: 900; padding: 20px; border-radius: 18px; font-size: 14px; letter-spacing: 2px; box-shadow: 0 10px 20px rgba(255,255,255,0.05); transition: 0.3s; }
    </style>
</head>
<body>

    <div class="preview-container">
        <div class="phone-mockup" id="phone">
            <img src="https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?q=80&w=500" class="w-full h-full object-cover opacity-20">
            <div id="sub-preview">ESMARAN AI<br>DENEME SATIRI</div>
        </div>
        <p class="text-[8px] text-center text-zinc-600 mt-2 tracking-[4px] font-bold">KONUMU PARMAKLA AYARLA</p>
    </div>

    <div class="control-panel">
        <input type="text" id="url-input" placeholder="Video linkini yapıştır kral..." class="input-dark focus:border-amber-500">

        <div class="color-area">
            <div id="picker"></div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="space-y-2">
                <label class="text-[9px] font-black text-zinc-500 uppercase italic">Yazı Tipi</label>
                <select id="font-style" onchange="sync()" class="input-dark !mb-0 text-xs">
                    <option value="'Inter'">Modern</option>
                    <option value="'Bebas Neue'">Devasa</option>
                    <option value="'Oswald'">Haberci</option>
                    <option value="'Montserrat'">Zarif</option>
                </select>
            </div>
            <div class="space-y-2">
                <label class="text-[9px] font-black text-zinc-500 uppercase italic">Kutu</label>
                <select id="bg-toggle" onchange="sync()" class="input-dark !mb-0 text-xs text-amber-500">
                    <option value="1">AÇIK</option>
                    <option value="0">KAPALI</option>
                </select>
            </div>
        </div>

        <div class="slider-group">
            <label><span>YAZI BOYUTU</span><span id="size-val">14px</span></label>
            <input type="range" id="size-range" min="10" max="40" value="14" oninput="sync()">
        </div>

        <div class="slider-group">
            <label><span>SATIR GENİŞLİĞİ (ENLEM)</span><span id="w-val">90%</span></label>
            <input type="range" id="w-range" min="40" max="95" value="90" oninput="sync()">
        </div>

        <div class="slider-group">
            <label><span>KUTU YÜKSEKLİĞİ (BOYLAM)</span><span id="h-val">auto</span></label>
            <input type="range" id="h-range" min="30" max="150" value="50" oninput="sync()">
        </div>

        <button onclick="startProduction()" id="main-btn" class="big-action-btn">VİDEOYU OLUŞTUR VE İNDİR</button>
    </div>

    <script>
        let x = 0, y = 0;
        const sub = document.getElementById('sub-preview');
        const picker = new iro.ColorPicker("#picker", { width: 140, color: "#fff", layout: [{ component: iro.ui.Wheel }] });

        function sync() {
            const size = document.getElementById('size-range').value;
            const w = document.getElementById('w-range').value;
            const h = document.getElementById('h-range').value;
            const font = document.getElementById('font-style').value;
            const bg = document.getElementById('bg-toggle').value;

            document.getElementById('size-val').innerText = size + 'px';
            document.getElementById('w-val').innerText = w + '%';
            document.getElementById('h-val').innerText = h + 'px';

            sub.style.fontSize = size + 'px';
            sub.style.width = w + '%';
            sub.style.height = h + 'px';
            sub.style.fontFamily = font;
            sub.style.color = picker.color.hexString;
            sub.style.backgroundColor = bg == "1" ? "rgba(0,0,0,0.8)" : "transparent";
        }

        picker.on('color:change', sync);

        // Dokunmatik Sürükleme (Sadece Telefon Mockup İçinde)
        let dragging = false, sx, sy;
        const phone = document.getElementById('phone');

        phone.addEventListener('touchstart', (e) => {
            if(e.target === sub) {
                dragging = true;
                sx = e.touches[0].clientX - x;
                sy = e.touches[0].clientY - y;
            }
        });

        window.addEventListener('touchmove', (e) => {
            if(dragging) {
                x = e.touches[0].clientX - sx;
                y = e.touches[0].clientY - sy;
                sub.style.transform = `translate3d(${x}px, ${y}px, 0)`;
            }
        }, { passive: false });

        window.addEventListener('touchend', () => dragging = false);

        async function startProduction() {
            const url = document.getElementById('url-input').value;
            if(!url) return alert("Link nerede kral?");
            
            const btn = document.getElementById('main-btn');
            btn.disabled = true; btn.innerText = "YAPAY ZEKA ÇEVİRİYOR...";

            try {
                const res = await fetch('https://esmaran-api.onrender.com/process', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        url: url,
                        color: picker.color.hexString,
                        font_size: document.getElementById('size-range').value,
                        w_val: document.getElementById('w-range').value,
                        h_val: document.getElementById('h-range').value,
                        x_pos: x,
                        y_pos: y,
                        bg: document.getElementById('bg-toggle').value == "1",
                        font: document.getElementById('font-style').value
                    })
                });
                const data = await res.json();
                if(data.status === 'success') window.location.href = data.download_url;
                else alert("Hata: " + data.message);
            } catch(e) { alert("Sunucu şu an uyanıyor, 20 saniye sonra tekrar dene."); }
            finally { btn.disabled = false; btn.innerText = "VİDEOYU OLUŞTUR VE İNDİR"; }
        }
        
        sync();
    </script>
</body>
</html>

