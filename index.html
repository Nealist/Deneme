<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esmaran AI | Ultra Pro Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@900&family=Montserrat:wght@900&family=Oswald:wght@700&family=Bebas+Neue&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #eee; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; }
        .sidebar { background: #080808; border-right: 1px solid #151515; overflow-y: auto; }
        .preview-area { background: #000; display: flex; align-items: center; justify-content: center; position: relative; }
        
        /* Mini Telefon Mockup */
        .mini-phone { 
            width: 160px; aspect-ratio: 9/16; background: #111; 
            border-radius: 25px; border: 3px solid #222; 
            position: relative; overflow: hidden; box-shadow: 0 0 40px rgba(245, 158, 11, 0.1);
        }
        
        #sub-preview { 
            position: absolute; cursor: move; display: flex; align-items: center; justify-content: center;
            text-align: center; font-weight: 900; line-height: 1.1; overflow: hidden;
            background: rgba(0,0,0,0.8); color: #fff; padding: 5px;
            top: 40%; left: 10%; touch-action: none;
        }

        .custom-slider { -webkit-appearance: none; width: 100%; height: 4px; background: #222; border-radius: 5px; outline: none; }
        .custom-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 15px; height: 15px; background: #f59e0b; border-radius: 50%; cursor: pointer; }
        .input-dark { background: #121212; border: 1px solid #222; padding: 10px; border-radius: 8px; width: 100%; color: #fff; font-size: 13px; }
    </style>
</head>
<body class="flex flex-col lg:flex-row">

    <aside class="sidebar w-full lg:w-[400px] p-5 space-y-5">
        <div class="flex items-center justify-between border-b border-white/5 pb-4">
            <h1 class="text-xl font-black italic tracking-tighter text-white">ESMARAN <span class="text-amber-500">AI</span></h1>
            <span class="text-[9px] bg-amber-500/10 text-amber-500 px-2 py-0.5 rounded-full border border-amber-500/20">V3.0 ULTIMATE</span>
        </div>

        <div class="space-y-2">
            <label class="text-[10px] font-bold text-gray-500 uppercase">Video Kaynağı</label>
            <input type="text" id="url" placeholder="Reels / TikTok linkini buraya bırak..." class="input-dark focus:border-amber-500 transition-all">
        </div>

        <div class="bg-[#0f0f0f] p-4 rounded-xl border border-white/5 space-y-4">
            <div id="picker" class="flex justify-center"></div>
            <div class="flex items-center justify-between pt-2">
                <span class="text-xs font-bold text-gray-400">ARKA PLAN KUTUSU</span>
                <input type="checkbox" id="bg-on" checked onchange="updatePreview()" class="w-5 h-5 accent-amber-500">
            </div>
        </div>

        <div class="space-y-2">
            <label class="text-[10px] font-bold text-gray-500 uppercase">Yazı Tipi (Style)</label>
            <select id="font-family" onchange="updatePreview()" class="input-dark">
                <option value="'Inter', sans-serif">Modern (Inter)</option>
                <option value="'Bebas Neue', cursive">Devasa (Bebas)</option>
                <option value="'Oswald', sans-serif">Haberci (Oswald)</option>
                <option value="'Montserrat', sans-serif">Zarif (Montserrat)</option>
                <option value="'Roboto Mono', monospace">Kod (Mono)</option>
            </select>
        </div>

        <div class="bg-[#0f0f0f] p-4 rounded-xl border border-white/5 space-y-4">
            <div class="space-y-2">
                <div class="flex justify-between text-[10px] font-bold text-gray-500 italic"><span>YAZI ENLEMİ</span><span id="w-val">120px</span></div>
                <input type="range" id="w-range" min="40" max="150" value="120" oninput="updatePreview()" class="custom-slider">
            </div>
            <div class="space-y-2">
                <div class="flex justify-between text-[10px] font-bold text-gray-500 italic"><span>YAZI BOYLAMI</span><span id="h-val">40px</span></div>
                <input type="range" id="h-range" min="20" max="120" value="40" oninput="updatePreview()" class="custom-slider">
            </div>
        </div>

        <button onclick="startProcess()" id="main-btn" class="w-full bg-white text-black font-black py-4 rounded-xl text-xs tracking-[5px] hover:bg-amber-500 transition-all shadow-lg active:scale-95">OLUŞTUR VE İNDİR</button>
    </aside>

    <main class="preview-area flex-1 flex-col">
        <div class="mini-phone" id="phone-container">
            <img src="https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?q=80&w=500" class="w-full h-full object-cover opacity-20">
            <div id="sub-preview">ESMARAN AI<br>DENEME METNİ</div>
        </div>
        <div class="mt-6 text-center">
            <p class="text-[10px] text-gray-600 font-bold tracking-[8px] uppercase">Canlı Ön İzleme</p>
            <p class="text-[9px] text-gray-700 mt-2 italic">Yazıyı telefon üzerinde parmağınla kaydırabilirsin</p>
        </div>
    </main>

    <script>
        let posX = 0, posY = 0;
        const sub = document.getElementById('sub-preview');
        const picker = new iro.ColorPicker("#picker", { width: 140, color: "#fff", layout: [{ component: iro.ui.Wheel }] });

        function updatePreview() {
            const w = document.getElementById('w-range').value;
            const h = document.getElementById('h-range').value;
            const font = document.getElementById('font-family').value;
            
            document.getElementById('w-val').innerText = w + 'px';
            document.getElementById('h-val').innerText = h + 'px';

            sub.style.width = w + 'px';
            sub.style.height = h + 'px';
            sub.style.fontFamily = font;
            sub.style.color = picker.color.hexString;
            sub.style.backgroundColor = document.getElementById('bg-on').checked ? 'rgba(0,0,0,0.8)' : 'transparent';
            sub.style.fontSize = (h / 3) + 'px';
        }

        picker.on('color:change', updatePreview);

        // Sürükleme Mantığı
        let isDragging = false, startX, startY;
        const container = document.getElementById('phone-container');

        const dragStart = (e) => {
            if(e.target === sub) {
                isDragging = true;
                startX = (e.touches ? e.touches[0].clientX : e.clientX) - posX;
                startY = (e.touches ? e.touches[0].clientY : e.clientY) - posY;
            }
        };

        const dragMove = (e) => {
            if(isDragging) {
                posX = (e.touches ? e.touches[0].clientX : e.clientX) - startX;
                posY = (e.touches ? e.touches[0].clientY : e.clientY) - startY;
                sub.style.transform = `translate3d(${posX}px, ${posY}px, 0)`;
            }
        };

        window.addEventListener('mouseup', () => isDragging = false);
        window.addEventListener('touchend', () => isDragging = false);
        container.addEventListener('mousedown', dragStart);
        window.addEventListener('mousemove', dragMove);
        container.addEventListener('touchstart', dragStart);
        window.addEventListener('touchmove', dragMove);

        async function startProcess() {
            const urlValue = document.getElementById('url').value;
            if(!urlValue) return alert("Hani link?");
            
            const btn = document.getElementById('main-btn');
            btn.disabled = true;
            btn.innerText = "YAPAY ZEKA ÇALIŞIYOR...";

            try {
                const response = await fetch('https://esmaran-api.onrender.com/process', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        url: urlValue,
                        color: picker.color.hexString,
                        w_val: document.getElementById('w-range').value,
                        h_val: document.getElementById('h-range').value,
                        x_pos: posX,
                        y_pos: posY,
                        bg: document.getElementById('bg-on').checked,
                        font: document.getElementById('font-family').value
                    })
                });
                const data = await response.json();
                if(data.status === 'success') window.location.href = data.download_url;
                else alert("Hata: " + data.message);
            } catch(e) {
                alert("Sunucu şu an uyanıyor, 30 saniye sonra tekrar bas kral!");
            } finally {
                btn.disabled = false;
                btn.innerText = "OLUŞTUR VE İNDİR";
            }
        }
        
        updatePreview();
    </script>
</body>
</html>

