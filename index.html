<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Esmaran AI | Final Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@900&family=Oswald:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #fff; font-family: 'Inter', sans-serif; padding: 10px; }
        .phone { width: 140px; aspect-ratio: 9/16; background: #111; border-radius: 20px; border: 2px solid #333; margin: 0 auto; position: relative; overflow: hidden; }
        #sub { 
            position: absolute; cursor: move; text-align: center; font-weight: 900; 
            background: rgba(0,0,0,0.8); color: #fff; padding: 6px; width: 85%; 
            left: 7.5%; top: 40%; font-size: 14px; touch-action: none;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .panel { background: #0a0a0a; border-radius: 25px; padding: 20px; border: 1px solid #1a1a1a; margin-top: 15px; }
        input[type="range"] { width: 100%; accent-color: #f59e0b; margin: 10px 0; }
        .go-btn { width: 100%; background: #fff; color: #000; font-weight: 900; padding: 18px; border-radius: 15px; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="phone" id="box">
        <img src="https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?q=80&w=500" class="w-full h-full object-cover opacity-20">
        <div id="sub">ALTYAZI ÖNİZLEME</div>
    </div>

    <div class="panel space-y-4">
        <input type="text" id="url" placeholder="Video Linki" class="w-full p-4 bg-black border border-zinc-800 rounded-xl outline-none">
        
        <div id="picker" class="flex justify-center"></div>

        <div class="grid grid-cols-2 gap-2">
            <select id="font" onchange="sync()" class="p-3 bg-black border border-zinc-800 rounded-lg text-xs">
                <option value="'Inter'">Modern</option>
                <option value="'Bebas Neue'">Devasa</option>
                <option value="'Oswald'">Haberci</option>
            </select>
            <select id="bg" onchange="sync()" class="p-3 bg-black border border-zinc-800 rounded-lg text-xs">
                <option value="1">KUTULU</option>
                <option value="0">SADE</option>
            </select>
        </div>

        <input type="range" id="size" min="10" max="45" value="14" oninput="sync()">
        <button onclick="go()" id="btn" class="go-btn">VİDEOYU OLUŞTUR</button>
    </div>

    <script>
        let x = 0, y = 0;
        const sub = document.getElementById('sub');
        const picker = new iro.ColorPicker("#picker", { width: 140, color: "#fff" });

        function sync() {
            sub.style.fontSize = document.getElementById('size').value + 'px';
            sub.style.fontFamily = document.getElementById('font').value;
            sub.style.color = picker.color.hexString;
            sub.style.background = document.getElementById('bg').value == "1" ? "rgba(0,0,0,0.8)" : "transparent";
        }
        picker.on('color:change', sync);

        let d = false, sx, sy;
        document.getElementById('box').addEventListener('touchstart', e => {
            if(e.target===sub){d=true; sx=e.touches[0].clientX-x; sy=e.touches[0].clientY-y;}
        });
        window.addEventListener('touchmove', e => {
            if(d){x=e.touches[0].clientX-sx; y=e.touches[0].clientY-sy; sub.style.transform=`translate3d(${x}px,${y}px,0)`;}
        });
        window.addEventListener('touchend', () => d=false);

        async function go() {
            const u = document.getElementById('url').value; if(!u) return;
            const b = document.getElementById('btn'); b.innerText = "YÜKLENİYOR..."; b.disabled = true;
            try {
                const r = await fetch('https://esmaran-api.onrender.com/process', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        url: u, color: picker.color.hexString, font_size: document.getElementById('size').value,
                        x_pos: x, y_pos: y, bg: document.getElementById('bg').value == "1"
                    })
                });
                const res = await r.json();
                if(res.status==='success') window.location.href = res.download_url;
                else alert(res.message);
            } catch(e) { alert("Sunucu uyanıyor..."); }
            finally { b.innerText = "VİDEOYU OLUŞTUR"; b.disabled = false; }
        }
    </script>
</body>
</html>

